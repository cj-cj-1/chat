{"version":3,"sources":[null,"webpack:///D:/毕业设计/chat/pages/chat/components/message/message.vue?8e2f","webpack:///D:/毕业设计/chat/pages/chat/components/message/message.vue?0d3b","webpack:///D:/毕业设计/chat/pages/chat/components/message/message.vue?b84c","uni-app:///pages/chat/components/message/message.vue","webpack:///D:/毕业设计/chat/pages/chat/components/message/message.vue?7d90","webpack:///D:/毕业设计/chat/pages/chat/components/message/message.vue?89a9"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAgI;AAChI;AAC2D;AACL;AACsC;;;AAG5F;AACmL;AACnL,gBAAgB,uLAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,8FAAM;AACR,EAAE,uGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,kGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC5BA;AAAA;AAAA;AAAA;AAAorB,CAAgB,mqBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC2DxsB,iE;AACA;AACA,yB;AACA;AACA,MADA,kBACA;AACA;AACA,kBADA,EACA;AACA,aAFA;AAGA,qBAHA;AAIA,mBAJA,EAIA;AACA,cALA;AAMA;AACA;AACA,gBARA;AASA,yBATA;AAUA,mBAVA,EAUA;AACA,oBAXA,EAWA;AACA,sBAZA;AAaA,eAbA;AAcA,oBAdA,EAcA;AACA,gBAfA,EAeA;AACA,mBAhBA,EAgBA;AACA,kBAjBA,CAiBA;AAjBA;AAmBA,GArBA;AAsBA;AACA;AACA;AACA;AAFA,KADA;AAKA;AACA;AACA;AAFA,KALA;AASA;AACA;AACA;AAFA,KATA;AAaA;AACA,kBADA;AAEA,iBAFA,EAbA;;AAiBA;AACA,kBADA;AAEA,iBAFA,EAjBA;;AAqBA;AACA,kBADA,EArBA;;AAwBA;AACA,kBADA;AAEA,iBAFA,EAxBA;;AA4BA;AACA,kBADA,EA5BA;;AA+BA;AACA,kBADA;AAEA,iBAFA,EA/BA;;AAmCA;AACA,kBADA;AAEA,iBAFA,EAnCA,EAtBA;;;AA8DA;AACA;AACA;AACA;AACA;AACA,cALA,wBAKA;AACA;AACA;AACA;AACA;AACA,yBALA,GAKA;AACA,+BADA;AAEA,wCAFA,GALA;;AASA,iBATA,GASA,CATA;AAUA;AACA;AACA;AACA;AACA;AACA,iBALA,EAKA,GALA;;AAOA;AACA;AACA,sBAnBA,GAmBA,YAnBA;AAoBA,wBApBA,GAoBA,cApBA;AAqBA;AACA,uBAtBA,GAsBA,aAtBA;AAuBA,wBAvBA,GAuBA,EAvBA;;AAyBA,kCAzBA;AA0BA;AACA,6CADA;AAEA;AACA,oCADA;AAEA,wCAFA;AAGA,sCAHA;AAIA,wCAJA,EAFA,GA1BA,UA0BA,MA1BA;;;;AAoCA,uBApCA,GAoCA,aApCA;AAqCA;AACA,iDADA;AAEA;AACA,oCADA;AAEA,sCAFA;AAGA,sCAHA;AAIA,wCAJA,EAFA,GArCA,UAqCA,MArCA;;;;AA+CA;AACA;AACA,sBAFA,GAEA,kBAFA;AAGA;AACA;AACA,mBAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAHA,MAGA;AACA;AACA;AACA;AACA,4BAJA,GAIA,qBAJA;AAKA;AACA;AACA,uBAPA,MAOA;AACA;AACA;AACA;AACA;AACA,uBAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAvFA;AAwFA,KA7FA;AA8FA;AACA,kBA/FA,4BA+FA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAHA,MAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAPA,MAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA1BA;;AA4BA,KA5HA;AA6HA;AACA,wBA9HA,kCA8HA;AACA;AACA;AACA;AACA;AACA;AACA,KApIA;AAqIA;AACA,kBAtIA,0BAsIA,MAtIA,EAsIA;AACA;AACA;AACA,sBADA;AAEA,4BAFA;;AAIA,KA5IA;AA6IA;AACA,mBA9IA,2BA8IA,QA9IA,EA8IA,SA9IA,EA8IA;AACA;AACA,0BADA;AAEA,4BAFA;AAGA;AACA;AACA,SALA;;AAOA,KAtJA;AAuJA;AACA,qBAxJA,6BAwJA,MAxJA,EAwJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SALA,MAKA;AACA;AACA;AACA,OAbA,MAaA;AACA;AACA;AACA;AACA;AACA;AACA,KAhLA,EA9DA;;;AAiPA;AACA;AACA,eAFA,yBAEA;AACA;AACA;AACA,OAFA;AAGA,KANA,EAjPA;;;AA0PA,SA1PA,qBA0PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GApQA;AAqQA,SArQA,qBAqQA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KARA;AASA,GAnRA;AAoRA,eApRA,2BAoRA;AACA;AACA;AACA;AACA,GAxRA,E;;;;;;;;;;;;;AC9DA;AAAA;AAAA;AAAA;AAAixC,CAAgB,6qCAAG,EAAC,C;;;;;;;;;;;ACAryC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/chat/components/message/message.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./message.vue?vue&type=template&id=94069398&scoped=true&\"\nvar renderjs\nimport script from \"./message.vue?vue&type=script&lang=js&\"\nexport * from \"./message.vue?vue&type=script&lang=js&\"\nimport style0 from \"./message.vue?vue&type=style&index=0&id=94069398&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"94069398\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/components/message/message.vue\"\nexport default component.exports","export * from \"-!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=template&id=94069398&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.messageList, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var m0 = item.userid !== _vm.userid ? _vm.getImageUrl(item.imgurl) : null\n    var m1 = !(item.userid !== _vm.userid) ? _vm.getImageUrl(item.imgurl) : null\n    return {\n      $orig: $orig,\n      m0: m0,\n      m1: m1\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=script&lang=js&\"","<template>\n\t<view class=\"message\" :style=\"{paddingBottom:bottomHeight+'px'}\" >\r\n\t\t<image src=\"/static/image/loading.png\" mode=\"\" :class=\"{loading:true, hide: loading}\" :animation=\"animatonData\"></image>\n\t\t<scroll-view scroll-y=\"true\" :scroll-top=\"scrollTop\" class=\"scroll-view\" :scroll-into-view=\"scrollTo\" @scrolltoupper=\"scrollToUpperRefresh\" >\r\n\t\t\t<view class=\"main\" >\r\n\t\t\t\t<view class=\"message-item\" v-for=\"(item, index) in messageList\" :key=\"index\" :id=\"'msg' + index\">\r\n\t\t\t\t\t<view class=\"\" v-if=\"item.userid !== userid\">\r\n\t\t\t\t\t\t<view class=\"time\" v-if=\"item.time\">{{item.time}}</view>\r\n\t\t\t\t\t\t<view class=\"bottom-left\">\r\n\t\t\t\t\t\t\t<image :src=\"getImageUrl(item.imgurl)\" mode=\"\" class=\"photo\" ></image>\r\n\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t<view class=\"group-username\" v-if=\"isgroup==1\">{{item.username}}</view>\r\n\t\t\t\t\t\t\t\t<view class=\"text-message-left\" v-if=\"item.type==0\">{{item.content}}</view>\r\n\t\t\t\t\t\t\t\t<image :src=\"item.content\" mode=\"widthFix\" class=\"image-left\" v-if=\"item.type==1\" @click=\"previewHandler(item.content)\"></image>\r\n\t\t\t\t\t\t\t\t<view class=\"record\" v-if=\"item.type==2\" :style=\"{width:item.content.time*4+'px'}\" @click=\"playRecordHandler(item.content.name)\">\r\n\t\t\t\t\t\t\t\t\t<image src=\"/static/image/record.png\" mode=\"\"></image>\r\n\t\t\t\t\t\t\t\t\t<view class=\"record-time\">{{item.content.time}}{{second}}</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"map-info\"v-if=\"item.type==3\" @click=\"mapClickHandler(item.content.latitude,item.content.longitude)\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"name\">\r\n\t\t\t\t\t\t\t\t\t\t{{item.content.name}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"address\">\r\n\t\t\t\t\t\t\t\t\t\t{{item.content.address}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<image src=\"/static/image/mapimage.jpg\" mode=\"\" class=\"mapimage\"></image>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"\" v-else>\r\n\t\t\t\t\t\t<view class=\"time\" v-if=\"item.time\">{{item.time}}</view>\r\n\t\t\t\t\t\t<view class=\"bottom-right\">\r\n\t\t\t\t\t\t\t<image :src=\"getImageUrl(item.imgurl)\" mode=\"\" class=\"photo\"></image>\r\n\t\t\t\t\t\t\t<view class=\"text-message-right\" v-if=\"item.type==0\">{{item.content}}</view>\r\n\t\t\t\t\t\t\t<image :src=\"item.content\" mode=\"widthFix\" class=\"image-right\" v-if=\"item.type==1\" @click=\"previewHandler(item.content)\"></image>\r\n\t\t\t\t\t\t\t<view class=\"record\" v-if=\"item.type==2\" :style=\"{width:item.content.time*4+'px'}\" @click=\"playRecordHandler(item.content.name)\">\r\n\t\t\t\t\t\t\t\t<image src=\"/static/image/record.png\" mode=\"\"></image>\r\n\t\t\t\t\t\t\t\t<view class=\"record-time\">{{item.content.time}}{{second}}</view>\r\n\t\t\t\t\t\t\t\t<view class=\"dot\"></view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"map-info\"v-if=\"item.type==3\" @click=\"mapClickHandler(item.content.latitude,item.content.longitude)\">\r\n\t\t\t\t\t\t\t\t<view class=\"name\">\r\n\t\t\t\t\t\t\t\t\t{{item.content.name}}\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"address\">\r\n\t\t\t\t\t\t\t\t\t{{item.content.address}}\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<image src=\"/static/image/mapimage.jpg\" mode=\"widthFix\" class=\"mapimage\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\n\t</view>\n</template>\n\n<script>\r\n\timport {getImageUrl, getChatTime, getRecordUrl} from '@/util/js/format.js'\r\n\tconst innerAudioContext = uni.createInnerAudioContext();\r\n\tlet newTime = new Date()\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tscrollTop: 0,\t\t\t//设置竖向滚动条位置\r\n\t\t\t\tid: \"a\",\r\n\t\t\t\tmessageList: [],\r\n\t\t\t\timageList: [],\t\t\t//存储图片\r\n\t\t\t\ttime:'',\r\n\t\t\t\t// scrollTo: '',\r\n\t\t\t\t// nowPage: 0,\r\n\t\t\t\tskipNum:0,\r\n\t\t\t\tlastMessageTime: '',\r\n\t\t\t\tloading: true,\t\t\t//隐藏loading\r\n\t\t\t\tthrottle: true,\t\t\t//节流阀\r\n\t\t\t\tanimatonData: {},\t\t\r\n\t\t\t\ttimer: '',\r\n\t\t\t\trecordPlay:{},\t\t\t//声音要播放还是暂停\r\n\t\t\t\trecord: '',\t\t\t\t//当前的录音地址\r\n\t\t\t\trecordArr:[],\t\t\t//所有录音的地址\r\n\t\t\t\tsecond:`\"`\t\t\t\t//秒\n\t\t\t}\n\t\t},\r\n\t\tprops:{\r\n\t\t\tuserid:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\t// default: ''\r\n\t\t\t},\r\n\t\t\tfriendid:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\t// default: ''\r\n\t\t\t},\r\n\t\t\tgroupid:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\t// default: ''\r\n\t\t\t},\r\n\t\t\timgurl:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\tfriendname:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\tisgroup:{\r\n\t\t\t\ttype:String\r\n\t\t\t},\r\n\t\t\tgroupname:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\tbottomHeight:{\r\n\t\t\t\ttype: Number\r\n\t\t\t},\r\n\t\t\tscrollTo:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\tvoicePath:{\r\n\t\t\t\ttype:String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t},\n\t\tmethods: {\r\n\t\t\t// getMessage(){\r\n\t\t\t// \tconsole.log(\"getMessage\")\r\n\t\t\t// },\n\t\t\t//请求数据\r\n\t\t\tasync getMessage(){\r\n\t\t\t\tthis.skipNum = this.messageList.length\r\n\t\t\t\t// console.log(this.messageList)\r\n\t\t\t\t//请求数据显示loading\r\n\t\t\t\tthis.loading = false\r\n\t\t\t\tlet animation = uni.createAnimation({\r\n\t\t\t\t  duration: 150,\r\n\t\t\t\t  timingFunction: \"ease\",\r\n\t\t\t\t})\r\n\t\t\t\tlet i = 1\r\n\t\t\t\tthis.timer = setInterval(()=>{\r\n\t\t\t\t\tanimation.rotate(36 * i).step()\r\n\t\t\t\t\ti++\r\n\t\t\t\t\t//触发动画\r\n\t\t\t\t\tthis.animatonData = animation.export()\r\n\t\t\t\t},150)\r\n\t\t\t\t\r\n\t\t\t\t//节流阀，防止多次请求数据，需要等处理完一次请求数据后才可以重新请求\r\n\t\t\t\tthis.throttle = false\r\n\t\t\t\tlet userid = this.userid\r\n\t\t\t\tlet friendid = this.friendid\r\n\t\t\t\t// console.log(userid, friendid)\r\n\t\t\t\tlet skipNum = this.skipNum\r\n\t\t\t\tlet pageSize = 11\r\n\t\t\t\tlet result;\r\n\t\t\t\tif(this.isgroup == 0){\r\n\t\t\t\t\tresult = await this.$myHttp({\r\n\t\t\t\t\t\turl:'/message/load-more',\r\n\t\t\t\t\t\tdata:{\r\n\t\t\t\t\t\t\tuserid,\r\n\t\t\t\t\t\t\tfriendid,\r\n\t\t\t\t\t\t\tskipNum,\r\n\t\t\t\t\t\t\tpageSize,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tlet groupid = this.groupid\r\n\t\t\t\t\tresult = await this.$myHttp({\r\n\t\t\t\t\t\turl:'/message/load-groupmsg',\r\n\t\t\t\t\t\tdata:{\r\n\t\t\t\t\t\t\tuserid,\r\n\t\t\t\t\t\t\tgroupid,\r\n\t\t\t\t\t\t\tskipNum,\r\n\t\t\t\t\t\t\tpageSize,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tif(result.data.status == 200){\r\n\t\t\t\t\t// console.log(\"shujucg\")\r\n\t\t\t\t\tlet data = result.data.result\r\n\t\t\t\t\tif(data.length == 0){\r\n\t\t\t\t\t\tthis.skipNum = -1\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t// console.log(data)\r\n\t\t\t\t\t\tif(this.skipNum == 0){\r\n\t\t\t\t\t\t\tthis.lastMessageTime = String(data[0].time)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//处理数据\r\n\t\t\t\t\t\tfor(let i = 0; i < data.length; i++){\r\n\t\t\t\t\t\t\tif(data[i].type == 1){\r\n\t\t\t\t\t\t\t\tdata[i].content = this.getImageUrl(data[i].content)\r\n\t\t\t\t\t\t\t\tthis.imageList.unshift(data[i].content)\r\n\t\t\t\t\t\t\t}else if(data[i].type == 2){\r\n\t\t\t\t\t\t\t\t// console.log(JSON.parse(data[i].content))\r\n\t\t\t\t\t\t\t\tdata[i].content = JSON.parse(data[i].content)\r\n\t\t\t\t\t\t\t\tdata[i].content.name =getRecordUrl(data[i].content.name)\r\n\t\t\t\t\t\t\t\tlet name = data[i].content.name\r\n\t\t\t\t\t\t\t\tthis.recordPlay[name] = true\r\n\t\t\t\t\t\t\t\tthis.recordArr.unshift(name)\r\n\t\t\t\t\t\t\t}else if(data[i].type == 3){\r\n\t\t\t\t\t\t\t\tdata[i].content = JSON.parse(data[i].content)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(i < data.length - 1){\r\n\t\t\t\t\t\t\t\tdata[i].time = getChatTime(data[i].time, data[i + 1].time)\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tdata[i].time = getChatTime(data[i].time)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.messageList.push(...data)\r\n\t\t\t\t\t\t// console.log(this.nowPage * pageSize)\r\n\t\t\t\t\t\t// this.$emit(\"changeScrollTo\", this.nowPage * pageSize - 1)\r\n\t\t\t\t\t\tthis.$emit(\"changeScrollTo\", this.skipNum - 1)\r\n\t\t\t\t\t\tthis.throttle = true\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//清除定时器，隐藏loading\r\n\t\t\t\t\tclearInterval(this.timer)\r\n\t\t\t\t\tthis.loading = true\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t//接收socket消息\r\n\t\t\treceiveMessage(){\r\n\t\t\t\tthis.socket.on('message', (message) => {\r\n\t\t\t\t\tif((!message.groupid && (message.userid == this.friendid || message.userid == this.userid)) || message.groupid == this.groupid){\r\n\t\t\t\t\t\t// console.log(message)\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//深拷贝对象，因为里面有日期对象，日期对象是引用对象\r\n\t\t\t\t\t\tlet newMessage = JSON.parse(JSON.stringify(message))\r\n\t\t\t\t\t\tlet tempTime = message.time\r\n\t\t\t\t\t\t// console.log(newMessage) \r\n\t\t\t\t\t\tif(newMessage.type == 1){\r\n\t\t\t\t\t\t\tnewMessage.content = this.getImageUrl(newMessage.content)\r\n\t\t\t\t\t\t\tthis.imageList.unshift(newMessage.content)\r\n\t\t\t\t\t\t}else if(newMessage.type == 2){\r\n\t\t\t\t\t\t\t// console.log(JSON.parse(data[i].content))\r\n\t\t\t\t\t\t\tnewMessage.content = JSON.parse(newMessage.content)\r\n\t\t\t\t\t\t\tnewMessage.content.name =getRecordUrl(newMessage.content.name)\r\n\t\t\t\t\t\t\tlet name = newMessage.content.name\r\n\t\t\t\t\t\t\tthis.recordPlay[name] = true\r\n\t\t\t\t\t\t\tthis.recordArr.unshift(name)\r\n\t\t\t\t\t\t}else if(newMessage.type == 3){\r\n\t\t\t\t\t\t\tnewMessage.content = JSON.parse(newMessage.content)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnewMessage.time = getChatTime(tempTime, this.lastMessageTime)\r\n\t\t\t\t\t\tthis.lastMessageTime = tempTime\r\n\t\t\t\t\t\tthis.messageList.unshift(newMessage)\r\n\t\t\t\t\t\tthis.$emit(\"changeScrollTo\")\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\t//下拉刷新\r\n\t\t\tscrollToUpperRefresh(){\r\n\t\t\t\t// console.log(\"hhhhhhh\")\r\n\t\t\t\tif(this.skipNum != -1&& this.throttle == true){\r\n\t\t\t\t\tthis.getMessage()\r\n\t\t\t\t}\r\n\t\t\t\t// this.$emit(\"changeScrollTo\")\r\n\t\t\t},\r\n\t\t\t//大图查看图片\r\n\t\t\tpreviewHandler(imgurl){\r\n\t\t\t\tlet index = this.imageList.indexOf(imgurl)\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent: index,\r\n\t\t\t\t\turls: this.imageList,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//点击查看地图详情\r\n\t\t\tmapClickHandler(latitude, longitude){\r\n\t\t\t\tuni.openLocation({\r\n\t\t\t\t\tlatitude: latitude,\r\n\t\t\t\t\tlongitude: longitude,\r\n\t\t\t\t\tsuccess: function () {\r\n\t\t\t\t\t\tconsole.log('success');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t//播放/停止录音\r\n\t\t\tplayRecordHandler(record){\r\n\t\t\t\tlet lastRecord = this.record\r\n\t\t\t\tthis.record = record\r\n\t\t\t\tlet isPlay = this.recordPlay[record]\r\n\t\t\t\t//判断当前点击的和上一次是否一样，如果一样说明有一次是播放，一次是暂停，所以需要把this.recordPlay[record]改了\r\n\t\t\t\tif(lastRecord == record){\r\n\t\t\t\t\tthis.recordPlay[record] = !isPlay\r\n\t\t\t\t\tisPlay = this.recordPlay[record]\r\n\t\t\t\t\t// console.log('播放/停止录音');\r\n\t\t\t\t\t// console.log(this.recordPlay)\r\n\t\t\t\t\tif (record && isPlay) {\r\n\t\t\t\t\t\t// console.log(record)\r\n\t\t\t\t\t\t// record = \"http://localhost:3001\" + record\r\n\t\t\t\t\t\tinnerAudioContext.src = record;\r\n\t\t\t\t\t\tinnerAudioContext.play();\r\n\t\t\t\t\t}else if(!isPlay){\r\n\t\t\t\t\t\tinnerAudioContext.stop();\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//如果不一样，那肯定就是要播放的\r\n\t\t\t\t\tthis.recordPlay[record] = true\r\n\t\t\t\t\tinnerAudioContext.src = record;\r\n\t\t\t\t\tinnerAudioContext.play();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\n\t\t},\r\n\t\tcomputed:{\r\n\t\t\t//获得完整图片地址\r\n\t\t\tgetImageUrl(){\r\n\t\t\t\treturn function(url){\r\n\t\t\t\t\treturn getImageUrl(url)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\t//进来时就更新一下当前时间\r\n\t\t\t// newTime = new Date()\r\n\t\t\t//调用请求数据的函数\r\n\t\t\tif(this.timer){\r\n\t\t\t\tclearInterval(this.timer)\r\n\t\t\t}\r\n\t\t\t// console.log(\"this.scrollTo\",\"hhh\")\r\n\t\t\t// this.getMessage()\r\n\t\t\t// console.log(this.getTime(new Date(\"2020,11,20\"), new Date(\"2020,11,19\")))\r\n\t\t},\r\n\t\tmounted(){\r\n\t\t\t\r\n\t\t\tthis.getMessage()\r\n\t\t\tthis.receiveMessage()\r\n\t\t\t// console.log(this.scrollTo,\"hhh\")\r\n\t\t\tinnerAudioContext.onEnded(() => {\r\n\t\t\t\t// console.log(\"结束\")\r\n\t\t\t\tthis.recordPlay[this.record] = false\r\n\t\t\t\t//找到目前播放的音频，在结束后手动调用点击事件，让音频自动播放\r\n\t\t\t\tlet index = this.recordArr.indexOf(this.record)\r\n\t\t\t\tif(index < this.recordArr.length - 1){\r\n\t\t\t\t\tthis.playRecordHandler(this.recordArr[index + 1])\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tbeforeDestroy() {\r\n\t\t\tif(this.timer){\r\n\t\t\t\tclearInterval(this.timer)\r\n\t\t\t}\r\n\t\t}\n\t}\n</script>\n\n<style lang=\"scss\" scoped>\r\n\t.message{\r\n\t\t// height: calc(100% - 88rpx - var(--status-bar-height));\r\n\t\theight: 100%;\r\n\t\t//这里需要设置为boder-box,要不然padding-bottom不会加在高度里面，导致message高度大于整个页面，会有滚动条\r\n\t\tbox-sizing: border-box;\r\n\t\t// padding-bottom: env(safe-area-inset-bottom);\r\n\t\tpadding-top: calc(88rpx + var(--status-bar-height));\r\n\t\ttext-align: center;\r\n\t\tbackground-color: #f7f7f7;\r\n\t\t.loading{\r\n\t\t\twidth: 40rpx;\r\n\t\t\theight: 40rpx;\r\n\t\t}\r\n\t\t.hide{\r\n\t\t\tdisplay: none;\r\n\t\t}\r\n\t}\n\t.scroll-view{\r\n\t\theight: 100%;\r\n\t\t// height: calc(100vh - 88rpx);\r\n\t\t//这里需要设置为boder-box,要不然padding-bottom不会加在高度里面，导致message高度大于整个页面，会有滚动条\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground-color:#f7f7f7;\r\n\t\t.main{\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column-reverse;\r\n\t\t}\r\n\t}\r\n\t.message-item{\r\n\t\tpadding: 28rpx 30rpx 0;\r\n\t\t.time{\r\n\t\t\ttext-align: center;\r\n\t\t\tfont-size: $uni-font-size-sm;\r\n\t\t\tcolor: $uni-text-color-grey;\r\n\t\t\tpadding-bottom: 10rpx;\r\n\t\t}\r\n\t\t.bottom-left{\r\n\t\t\tdisplay: flex;\t\r\n\t\t\t.photo{\r\n\t\t\t\twidth: 80rpx;\r\n\t\t\t\theight: 80rpx;\r\n\t\t\t\tborder-radius: 10rpx;\r\n\t\t\t}\r\n\t\t\t.group-username{\r\n\t\t\t\tfont-size: $uni-font-size-sm;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\tmargin-left:25rpx;\r\n\t\t\t}\r\n\t\t\t.text-message-left{\r\n\t\t\t\tmax-width: 480rpx;\r\n\t\t\t\tpadding: 16rpx 20rpx;\r\n\t\t\t\tborder-radius: 0rpx 20rpx 20rpx 20rpx;\r\n\t\t\t\tbackground-color: #fff;\r\n\t\t\t\tmargin-left:20rpx;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t}\r\n\t\t\t.image-left{\r\n\t\t\t\tmax-width: 300rpx;\r\n\t\t\t\tmargin-left:20rpx;\r\n\t\t\t}\r\n\t\t\t.map-info{\r\n\t\t\t\twidth: 350rpx;\r\n\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\tbackground-color: #fff;\r\n\t\t\t\t.name{\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\twhite-space: nowrap;\r\n\t\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\t\tfont-size: $uni-font-size-base;\r\n\t\t\t\t\tpadding: 10rpx 5rpx;\r\n\t\t\t\t}\r\n\t\t\t\t.address{\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\twhite-space: nowrap;\r\n\t\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\t\tfont-size: $uni-font-size-sm;\r\n\t\t\t\t\tpadding: 0rpx 10rpx ;\r\n\t\t\t\t\tcolor: $uni-text-color-grey;\r\n\t\t\t\t}\r\n\t\t\t\timage{\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\theight: 200rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t.record{\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tbackground-color: #fff;\r\n\t\t\t\tborder-radius: 0rpx 20rpx 20rpx 20rpx;\r\n\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\tmin-width: 60rpx;\r\n\t\t\t\tmax-width: 480rpx;\r\n\t\t\t\tpadding: 16rpx 20rpx;\r\n\t\t\t\tfont-size: $uni-font-size-sm;\r\n\t\t\t\timage{\r\n\t\t\t\t\twidth: 35rpx;\r\n\t\t\t\t\theight: 35rpx;\r\n\t\t\t\t\tmargin-right: 6rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t\t.bottom-right{\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: row-reverse;\r\n\t\t\t.photo{\r\n\t\t\t\twidth: 80rpx;\r\n\t\t\t\theight: 80rpx;\r\n\t\t\t\tborder-radius: 10rpx;\r\n\t\t\t}\r\n\t\t\t.text-message-right{\r\n\t\t\t\tmax-width: 480rpx;\r\n\t\t\t\tpadding: 16rpx 20rpx;\r\n\t\t\t\tborder-radius: 20rpx 0rpx 20rpx 20rpx;\r\n\t\t\t\tbackground-color: #fff157;\r\n\t\t\t\tmargin-right:20rpx;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t}\r\n\t\t\t.image-right{\r\n\t\t\t\tmax-width: 300rpx;\r\n\t\t\t\tmargin-right:20rpx;\r\n\t\t\t}\r\n\t\t\t.map-info{\r\n\t\t\t\twidth: 350rpx;\r\n\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\tbackground-color: #fff;\r\n\t\t\t\t.name{\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\twhite-space: nowrap;\r\n\t\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\t\tfont-size: $uni-font-size-base;\r\n\t\t\t\t\tpadding: 10rpx 5rpx;\r\n\t\t\t\t}\r\n\t\t\t\t.address{\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t\toverflow: hidden;\r\n\t\t\t\t\twhite-space: nowrap;\r\n\t\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\t\tfont-size: $uni-font-size-sm;\r\n\t\t\t\t\tpadding: 0rpx 10rpx ;\r\n\t\t\t\t\tcolor: $uni-text-color-grey;\r\n\t\t\t\t}\r\n\t\t\t\timage{\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\theight: 200rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t.record{\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tbackground-color: #fff157;\r\n\t\t\t\tborder-radius: 20rpx 0rpx 20rpx 20rpx;\r\n\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\tmin-width: 60rpx;\r\n\t\t\t\tmax-width: 480rpx;\r\n\t\t\t\tpadding: 16rpx 20rpx;\r\n\t\t\t\tfont-size: $uni-font-size-sm;\r\n\t\t\t\timage{\r\n\t\t\t\t\twidth: 35rpx;\r\n\t\t\t\t\theight: 35rpx;\r\n\t\t\t\t\tmargin-right: 6rpx;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\n</style>\n","import mod from \"-!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=style&index=0&id=94069398&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./message.vue?vue&type=style&index=0&id=94069398&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1612686549105\n      var cssReload = require(\"D:/HBuilderX/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}